<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sorteo Fortuna Play‚Ñ¢</title>

<style>
body{
  font-family:'Segoe UI',Arial,sans-serif;
  /* üñºÔ∏è Fondo con imagen y degrad√© oscuro encima */
  background:
    linear-gradient(135deg, rgba(17,17,17,0.85), rgba(0,0,0,0.85)),
    url('https://iili.io/KaQb5WF.md.webp') center/cover no-repeat fixed;
  color:#fff;
  text-align:center;
  margin:0;
  padding:0;
}
header img{
  width:90%;
  max-width:600px;
  height:auto;
  display:block;
  margin:20px auto 10px;
  border-radius:16px;
  box-shadow:0 0 25px rgba(0,255,0,0.5);
  backdrop-filter:blur(5px);
}
h1{
  margin:20px 10px;
  color:#0f0;
  text-shadow:0 0 15px rgba(0,255,0,0.8),0 0 30px rgba(0,255,0,0.6);
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(50px,1fr));
  gap:8px;
  max-width:600px;
  margin:20px auto;
  padding:10px;
  background:rgba(255,255,255,0.05);
  border-radius:16px;
  box-shadow:0 0 20px rgba(0,255,0,0.1);
  backdrop-filter:blur(6px);
}
.num{
  background:rgba(255,255,255,0.1);
  padding:12px 0;
  border-radius:10px;
  cursor:pointer;
  transition:all .25s;
  font-size:1.1rem;
  font-weight:bold;
  box-shadow:0 0 10px rgba(0,0,0,0.3);
}
.num:hover{
  background:rgba(0,255,0,0.3);
  color:#000;
  box-shadow:0 0 12px rgba(0,255,0,0.7);
}
.selected{
  background:rgba(0,255,0,0.6);
  color:#000;
  box-shadow:0 0 18px rgba(0,255,0,0.8);
}
.bloqueado{
  background:rgba(255,255,255,0.1);
  color:rgba(255,255,255,0.4);
  text-decoration:line-through;
  cursor:not-allowed;
}
.button-box{
  margin:25px auto 40px;
}
.button-box button{
  padding:18px 50px;
  border:none;
  border-radius:12px;
  background:linear-gradient(45deg,#00ff88,#00d0ff,#ff00ff);
  background-size:600% 600%;
  color:#000;
  font-weight:bold;
  font-size:1.3rem;
  cursor:pointer;
  box-shadow:0 0 25px rgba(0,255,255,0.4);
  animation:gradiente 6s ease infinite;
}
@keyframes gradiente{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
.button-box button:hover{
  transform:scale(1.05);
  box-shadow:0 0 35px rgba(0,255,255,0.7);
}

/* ===== Modal animado ===== */
.modal{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.7);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:1000;
}
.modal-content{
  background:linear-gradient(135deg,#222,#111);
  border:3px solid #0f0;
  border-radius:16px;
  padding:25px;
  max-width:350px;
  text-align:center;
  color:#fff;
  animation:zoomIn .4s ease;
  box-shadow:0 0 30px rgba(0,255,0,0.6);
}
@keyframes zoomIn{
  from{transform:scale(0.5);opacity:0;}
  to{transform:scale(1);opacity:1;}
}
.modal-content h2{
  color:#0f0;
  margin-bottom:10px;
}
.modal-content p{
  font-size:1rem;
  line-height:1.4;
  margin-bottom:15px;
}
.modal-content button{
  padding:10px 30px;
  border:none;
  border-radius:8px;
  background:#0f0;
  color:#000;
  font-weight:bold;
  cursor:pointer;
  transition:background .2s;
}
.modal-content button:hover{background:#7f7;}
</style>
</head>
<body>

<header>
  <!-- üÜï Nuevo logo -->
  <img src="https://iili.io/KaQZyss.md.jpg" alt="Fortuna Play Logo">
</header>

<h1>üéâ Eleg√≠ tu n√∫mero üéâ</h1>

<div class="grid" id="grid"></div>

<div class="button-box">
  <button onclick="reservar()">Reservar n√∫mero</button>
</div>

<!-- Modal colorido -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h2>üéØ N√∫mero reservado!</h2>
    <p id="modalText"></p>
    <button onclick="cerrarModal()">Cerrar</button>
  </div>
</div>

<script>
const grid = document.getElementById('grid');
let elegido = null;
let bloqueados = [];
let cajeroActual = null;
const modal = document.getElementById('modal');
const modalText = document.getElementById('modalText');

// Cargar bloqueados
function cargarBloqueados(){
  fetch('/api/bloqueados')
    .then(r=>r.json())
    .then(d=>{ bloqueados=d.bloqueados; renderGrid(); });
}
// Obtener cajero
fetch('/api/cajero')
  .then(r=>r.json())
  .then(d=>{ cajeroActual=d.cajero; });

// Dibujar grilla
function renderGrid(){
  grid.innerHTML="";
  for(let i=1;i<=100;i++){
    const div=document.createElement('div');
    div.textContent=i;
    if(bloqueados.includes(i)){
      div.className='num bloqueado';
    }else{
      div.className='num';
      div.onclick=()=>{if(div.classList.contains('bloqueado'))return;
        document.querySelectorAll('.num').forEach(n=>n.classList.remove('selected'));
        div.classList.add('selected');
        elegido=i;
      };
    }
    grid.appendChild(div);
  }
}

// Reservar
function reservar(){
  if(!elegido || !cajeroActual){
    showModal("Eleg√≠ un n√∫mero libre antes de reservar üòâ");
    return;
  }
  fetch('/api/registrar',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({numero:elegido,telefono:'sin-dato'})
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.ok){
      showModal(
        `Tu n√∫mero <b>${elegido}</b> fue reservado ‚úÖ<br><br>` +
        `Tu cajero asignado es <b>Facu</b>.<br>` +
        `Escribile por WhatsApp para solicitar tu carga y ` +
        `reservar tu numerito (posible ganador ü§ë).<br><br>` +
        `Gracias por participar y ¬°mucha suerte! üì≤üçÄ`
      );
      cargarBloqueados();
      const msg=`Hola Facu! Mi n√∫mero elegido para el sorteo es ${elegido}`;
      window.open(`https://wa.me/${cajeroActual}?text=${encodeURIComponent(msg)}`,'_blank');
    }else{
      showModal("Ese n√∫mero ya fue ocupado, eleg√≠ otro üòÖ");
      cargarBloqueados();
    }
  });
}

// Modal helpers
function showModal(html){
  modalText.innerHTML = html;
  modal.style.display='flex';
}
function cerrarModal(){
  modal.style.display='none';
}

// Primera carga
cargarBloqueados();
</script>

</body>
</html>
